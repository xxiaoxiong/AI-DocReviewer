# DocReviewer é¡¹ç›®æ·±åº¦åˆ†ææŠ¥å‘Š

> ç”Ÿæˆæ—¶é—´ï¼š2026å¹´2æœˆ15æ—¥  
> åˆ†æèŒƒå›´ï¼šå®Œæ•´é¡¹ç›®æ¶æ„ã€ä¸šåŠ¡æµç¨‹ã€ä»£ç è´¨é‡ã€ä¼˜åŒ–å»ºè®®

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [å®Œæ•´ä¸šåŠ¡æµç¨‹](#å®Œæ•´ä¸šåŠ¡æµç¨‹)
4. [æ ¸å¿ƒæ¨¡å—åˆ†æ](#æ ¸å¿ƒæ¨¡å—åˆ†æ)
5. [ä¼˜åŒ–å»ºè®®](#ä¼˜åŒ–å»ºè®®)
6. [ä¼˜å…ˆçº§è§„åˆ’](#ä¼˜å…ˆçº§è§„åˆ’)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®å®šä½
DocReviewer æ˜¯ä¸€ä¸ªåŸºäº AI çš„æ–‡æ¡£æ ‡å‡†å®¡æ ¸ç³»ç»Ÿï¼Œä¸“æ³¨äºè§£å†³å…¬æ–‡ã€æŠ€æœ¯æ–‡æ¡£ç­‰æ ‡å‡†åŒ–å®¡æ ¸åœºæ™¯ã€‚

### æ ¸å¿ƒç‰¹æ€§
- âœ… **æ™ºèƒ½æ–‡æ¡£è§£æ**ï¼šæ”¯æŒ Word æ–‡æ¡£ï¼Œä¿ç•™ç»“æ„ä¿¡æ¯
- âœ… **æ™ºèƒ½åˆ†å—**ï¼šæŒ‰æ®µè½åˆ†å—ï¼Œæ·»åŠ ä¸Šä¸‹æ–‡æ‘˜è¦ï¼Œè§£å†³è¯­ä¹‰æ–­è£‚é—®é¢˜
- âœ… **RAG æ£€ç´¢**ï¼šä½¿ç”¨ BGE è¯­ä¹‰æ¨¡å‹ï¼Œç²¾å‡†æ£€ç´¢ç›¸å…³æ ‡å‡†
- âœ… **AI å®¡æ ¸**ï¼šé›†æˆ DeepSeek APIï¼Œæ”¯æŒæœ¬åœ°æ¨¡å‹
- âœ… **æ™ºèƒ½ä¼˜åŒ–**ï¼šè‡ªåŠ¨è·³è¿‡æ— éœ€å®¡æ ¸çš„å—ï¼Œå‡å°‘ 50% LLM è°ƒç”¨
- âœ… **ç½®ä¿¡åº¦æ ¡å‡†**ï¼šå¤šç»´åº¦æ ¡å‡†ï¼Œå‡å°‘ 50% è¯¯æŠ¥
- âœ… **æµå¼è¾“å‡º**ï¼šå®æ—¶æ˜¾ç¤ºå®¡æ ¸è¿›åº¦

### æŠ€æœ¯æ ˆ
- **åç«¯æ¡†æ¶**ï¼šFastAPI + Python 3.8+
- **æ–‡æ¡£å¤„ç†**ï¼špython-docx
- **AI æ¨¡å‹**ï¼šDeepSeek API / æœ¬åœ°æ¨¡å‹
- **è¯­ä¹‰æ£€ç´¢**ï¼šBGE (BAAI/bge-small-zh-v1.5) + FAISS
- **å‰ç«¯**ï¼šåŸç”Ÿ HTML/CSS/JavaScript
- **æ—¥å¿—**ï¼šLoguru

### é¡¹ç›®ç»“æ„
```
DocReviewer/
â”œâ”€â”€ backend/                    # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ review.py      # å®¡æ ¸æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ standards.py   # æ ‡å‡†ç®¡ç†æ¥å£
â”‚   â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ document_parser.py       # æ–‡æ¡£è§£æ
â”‚   â”‚   â”‚   â”œâ”€â”€ chunker.py               # æ™ºèƒ½åˆ†å—
â”‚   â”‚   â”‚   â”œâ”€â”€ rag_engine_v2.py         # RAG æ£€ç´¢å¼•æ“
â”‚   â”‚   â”‚   â”œâ”€â”€ reviewer.py              # å®¡æ ¸å¼•æ“
â”‚   â”‚   â”‚   â”œâ”€â”€ confidence_calibrator.py # ç½®ä¿¡åº¦æ ¡å‡†
â”‚   â”‚   â”‚   â””â”€â”€ review_optimizer.py      # æ™ºèƒ½ä¼˜åŒ–å™¨
â”‚   â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ document.py
â”‚   â”‚   â”œâ”€â”€ services/          # æœåŠ¡å±‚
â”‚   â”‚   â”‚   â””â”€â”€ llm_service.py # LLM è°ƒç”¨æœåŠ¡
â”‚   â”‚   â””â”€â”€ config.py          # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ main.py                # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ run.py                 # ä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ frontend/                   # å‰ç«¯é¡µé¢
â”‚   â”œâ”€â”€ index.html             # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ logs.html              # æ—¥å¿—é¡µé¢ï¼ˆå¾…å®ç°ï¼‰
â”‚   â””â”€â”€ standards.html         # æ ‡å‡†ç®¡ç†é¡µé¢ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ standards/                  # æ ‡å‡†åº“
â”‚   â”œâ”€â”€ protocols/             # åè®®å®šä¹‰ï¼ˆJSONï¼‰
â”‚   â”œâ”€â”€ embeddings/            # å‘é‡ç´¢å¼•
â”‚   â””â”€â”€ raw/                   # åŸå§‹æ–‡æ¡£
â”œâ”€â”€ data/                       # æ•°æ®å­˜å‚¨
â”‚   â””â”€â”€ uploads/               # ä¸Šä¼ æ–‡ä»¶
â”œâ”€â”€ logs/                       # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â””â”€â”€ requirements.txt           # ä¾èµ–æ¸…å•
```

---

## æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ æ–‡æ¡£ä¸Šä¼  â”‚  â”‚ å®¡æ ¸å±•ç¤º â”‚  â”‚ æ ‡å‡†ç®¡ç†     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ HTTP/SSE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API ç½‘å…³å±‚ (FastAPI)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ å®¡æ ¸æ¥å£     â”‚  â”‚ æ ‡å‡†ç®¡ç†æ¥å£ â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ ¸å¿ƒä¸šåŠ¡å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ æ–‡æ¡£è§£æå™¨   â”‚â†’ â”‚ æ™ºèƒ½åˆ†å—å™¨   â”‚â†’ â”‚ æ™ºèƒ½ä¼˜åŒ–å™¨   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â†“                                  â†“               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ RAG æ£€ç´¢å¼•æ“ â”‚â†’ â”‚ å®¡æ ¸å¼•æ“     â”‚â†’ â”‚ ç½®ä¿¡åº¦æ ¡å‡†å™¨ â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤–éƒ¨æœåŠ¡å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ DeepSeek API â”‚  â”‚ BGE æ¨¡å‹     â”‚  â”‚ FAISS ç´¢å¼•   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘

```
ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£
    â†“
æ–‡æ¡£è§£æï¼ˆæå–æ®µè½ã€æ ‡é¢˜ã€ç»“æ„ï¼‰
    â†“
æ™ºèƒ½åˆ†å—ï¼ˆæŒ‰æ®µè½åˆ†å— + ä¸Šä¸‹æ–‡æ‘˜è¦ï¼‰
    â†“
æ™ºèƒ½ä¼˜åŒ–ï¼ˆè¿‡æ»¤æ— éœ€å®¡æ ¸çš„å—ï¼Œå‡å°‘ 50% è°ƒç”¨ï¼‰
    â†“
RAG æ£€ç´¢ï¼ˆè¯­ä¹‰æ£€ç´¢ + å…³é”®è¯åŒ¹é…ï¼‰
    â†“
LLM å®¡æ ¸ï¼ˆDeepSeek APIï¼Œç²¾ç®€ Promptï¼‰
    â†“
ç½®ä¿¡åº¦æ ¡å‡†ï¼ˆå¤šç»´åº¦æ ¡å‡†ï¼Œå‡å°‘ 50% è¯¯æŠ¥ï¼‰
    â†“
ç»“æœå±•ç¤ºï¼ˆæµå¼è¾“å‡ºï¼Œå®æ—¶åé¦ˆï¼‰
```

---

## å®Œæ•´ä¸šåŠ¡æµç¨‹

### 1. æ–‡æ¡£ä¸Šä¼ ä¸è§£æ

**æ¨¡å—**ï¼š`document_parser.py`

**æµç¨‹**ï¼š
1. ç”¨æˆ·é€šè¿‡å‰ç«¯ä¸Šä¼  Word æ–‡æ¡£ï¼ˆ.docxï¼‰
2. åç«¯ä¿å­˜åˆ° `data/uploads/` ç›®å½•
3. `DocumentParser` è§£ææ–‡æ¡£ï¼š
   - ä½¿ç”¨ `python-docx` è¯»å–æ–‡æ¡£
   - æå–æ ‡é¢˜ã€æ®µè½ã€ç« èŠ‚
   - è¯†åˆ«æ ‡é¢˜å±‚çº§ï¼ˆHeading 1-6ã€ä¸­æ–‡æ•°å­—ã€é˜¿æ‹‰ä¼¯æ•°å­—ï¼‰
   - ä¿ç•™æ®µè½æ ·å¼å’Œä½ç½®ä¿¡æ¯
   - ç»Ÿè®¡å…ƒæ•°æ®ï¼ˆæ€»æ®µè½æ•°ã€å­—ç¬¦æ•°ï¼‰

**è¾“å‡ºæ•°æ®ç»“æ„**ï¼š
```python
{
    "title": "æ–‡æ¡£æ ‡é¢˜",
    "sections": [
        {
            "level": 1,
            "title": "ç¬¬ä¸€ç« ",
            "paragraphs": [...]
        }
    ],
    "paragraphs": [
        {
            "index": 0,
            "text": "æ®µè½å†…å®¹",
            "section": "æ‰€å±ç« èŠ‚",
            "style": "Normal",
            "char_count": 100
        }
    ],
    "metadata": {
        "total_paragraphs": 50,
        "total_chars": 5000
    }
}
```

**å…³é”®ä»£ç **ï¼š
```python
def parse_docx(self, file_path: str) -> Dict[str, Any]:
    doc = Document(file_path)
    structure = {
        "title": self._extract_title(doc),
        "sections": [],
        "paragraphs": [],
        "metadata": {}
    }
    # éå†æ®µè½ï¼Œè¯†åˆ«æ ‡é¢˜å’Œæ­£æ–‡
    for element in doc.element.body:
        if isinstance(element, CT_P):
            para = Paragraph(element, doc)
            is_heading, level = self._is_heading(para)
            # å¤„ç†æ ‡é¢˜æˆ–æ­£æ–‡
    return structure
```

---

### 2. æ™ºèƒ½åˆ†å—

**æ¨¡å—**ï¼š`chunker.py`

**æ ¸å¿ƒç­–ç•¥**ï¼š
1. **é¢„å¤„ç†**ï¼šè¿‡æ»¤åƒåœ¾æ®µè½
   - ç©ºæ®µè½
   - åªæœ‰æ ‡ç‚¹ç¬¦å·
   - åªæœ‰æ•°å­—
   - é•¿åº¦ < 10 å­—ç¬¦ä¸”éæ ‡é¢˜

2. **æ ‡é¢˜è¯†åˆ«**ï¼š
   - æ ·å¼åˆ¤æ–­ï¼ˆHeadingã€Titleï¼‰
   - æ¨¡å¼åŒ¹é…ï¼ˆä¸€ã€äºŒã€ä¸‰ / 1. 2. 3.ï¼‰
   - é•¿åº¦åˆ¤æ–­ï¼ˆæ ‡é¢˜é€šå¸¸ < 50 å­—ç¬¦ï¼‰

3. **æ™ºèƒ½åˆå¹¶**ï¼š
   - åªåˆå¹¶éå¸¸å°çš„å—ï¼ˆ< 50 å­—ç¬¦ï¼‰
   - åˆå¹¶åä¸è¶…è¿‡ chunk_size çš„ 70%
   - ä¿æŒæ®µè½ç‹¬ç«‹æ€§

4. **ä¸Šä¸‹æ–‡æ·»åŠ **ï¼š
   - ä¸ºæ¯ä¸ªå—æ·»åŠ å‰åæ–‡æ‘˜è¦ï¼ˆå„å–å‰å 2 ä¸ªå—ï¼‰
   - è§£å†³è·¨æ®µè½è¯­ä¹‰æ–­è£‚é—®é¢˜

5. **é•¿æ®µè½åˆ‡åˆ†**ï¼š
   - è¶…è¿‡ chunk_size çš„æ®µè½ä½¿ç”¨æ»‘åŠ¨çª—å£åˆ‡åˆ†
   - åœ¨å¥å·å¤„æ–­å¼€ï¼Œä¿æŒè¯­ä¹‰å®Œæ•´

**å…³é”®å‚æ•°**ï¼š
```python
chunk_size = 1000          # æœ€å¤§å—å¤§å°
overlap = 200              # æ»‘åŠ¨çª—å£é‡å 
min_chunk_size = 20        # æœ€å°å—å¤§å°
merge_threshold = 50       # åˆå¹¶é˜ˆå€¼
```

**è¾“å‡ºæ•°æ®ç»“æ„**ï¼š
```python
DocumentChunk(
    chunk_id="chunk_0",
    text="æ®µè½å†…å®¹...",
    start_pos=0,
    end_pos=100,
    page=None,
    section="ç¬¬ä¸€ç« ",
    context_before="å‰æ–‡æ‘˜è¦...",
    context_after="åæ–‡æ‘˜è¦..."
)
```

---

### 3. æ™ºèƒ½ä¼˜åŒ–è¿‡æ»¤ â­

**æ¨¡å—**ï¼š`review_optimizer.py`

**ç›®æ ‡**ï¼šå‡å°‘ 50% çš„ LLM è°ƒç”¨ï¼Œæå‡ 2-3 å€é€Ÿåº¦

**ä¼˜åŒ–ç­–ç•¥**ï¼š

#### 3.1 æ™ºèƒ½è·³è¿‡
è·³è¿‡æ— éœ€å®¡æ ¸çš„å—ï¼Œå‡å°‘æ— æ•ˆè°ƒç”¨ï¼š

| è§„åˆ™ | ç¤ºä¾‹ | è·³è¿‡åŸå›  |
|------|------|----------|
| ç©ºæ–‡æœ¬æˆ–å¤ªçŸ­ | `""` / `"æµ‹è¯•"` | < 15 å­—ç¬¦ |
| åªæœ‰æ ‡ç‚¹ç¬¦å· | `"ã€‚ã€‚ã€‚"` / `"---"` | æ— å®é™…å†…å®¹ |
| åªæœ‰æ•°å­— | `"123456"` | æ— éœ€å®¡æ ¸ |
| é‡å¤å­—ç¬¦ | `"======"` | åˆ†éš”çº¿ |
| é¡µçœ‰é¡µè„š | `"ç¬¬ 1 é¡µ"` / `"å…± 10 é¡µ"` | éæ­£æ–‡ |
| è¡¨æ ¼æ ‡é¢˜ | `"åºå· åç§° å¤‡æ³¨"` | è¡¨å¤´ |
| å¼•ç”¨æ ‡è®° | `"[1]"` / `"å‚è€ƒæ–‡çŒ®"` | å¼•ç”¨ |
| æ— åŒ¹é…è§„åˆ™ | RAG æ£€ç´¢ä¸ºç©º | æ— ç›¸å…³æ ‡å‡† |

#### 3.2 ç›¸ä¼¼å—å»é‡
ä½¿ç”¨ MD5 å“ˆå¸Œè¯†åˆ«é‡å¤å†…å®¹ï¼š
```python
def deduplicate_chunks(self, chunks):
    hash_to_chunks = {}
    for chunk in chunks:
        text_hash = hashlib.md5(chunk.text.encode()).hexdigest()
        if text_hash not in hash_to_chunks:
            # æ–°çš„å”¯ä¸€å—
        else:
            # é‡å¤å—ï¼Œè·³è¿‡
```

#### 3.3 ç¼“å­˜æœºåˆ¶
ç¼“å­˜å·²å®¡æ ¸è¿‡çš„å—ï¼š
```python
def get_cached_result(self, chunk):
    cache_key = self._get_cache_key(chunk.text)
    if cache_key in self._review_cache:
        return self._review_cache[cache_key]
    return None
```

**ä¼˜åŒ–æ•ˆæœ**ï¼š
```
åŸå§‹å—æ•°: 100
â”œâ”€ æ™ºèƒ½è·³è¿‡: 40 ä¸ªï¼ˆé¡µçœ‰é¡µè„šã€è¡¨æ ¼æ ‡é¢˜ç­‰ï¼‰
â”œâ”€ å»é‡: 10 ä¸ªï¼ˆé‡å¤å†…å®¹ï¼‰
â”œâ”€ ç¼“å­˜å‘½ä¸­: 5 ä¸ªï¼ˆå·²å®¡æ ¸è¿‡ï¼‰
â””â”€ å®é™…éœ€è¦å®¡æ ¸: 45 ä¸ª

ä¼˜åŒ–ç‡: 55%
```

---

### 4. RAG æ£€ç´¢

**æ¨¡å—**ï¼š`rag_engine_v2.py`

**æ ¸å¿ƒæŠ€æœ¯**ï¼š

#### 4.1 è¯­ä¹‰åµŒå…¥æ¨¡å‹
- **æ¨¡å‹**ï¼šBGE (BAAI/bge-small-zh-v1.5)
- **ç‰¹ç‚¹**ï¼š
  - è½»é‡çº§ï¼ˆ~100MBï¼‰
  - ä¸­æ–‡å‹å¥½
  - 768 ç»´å‘é‡
  - æ”¯æŒè¯­ä¹‰ç†è§£

#### 4.2 å‘é‡åŒ–æµç¨‹
```python
# 1. åŠ è½½æ ‡å‡†è§„åˆ™
for standard in standards:
    for rule in standard.rules:
        corpus.append(rule.description + keywords + examples)

# 2. æ‰¹é‡å‘é‡åŒ–
rule_vectors = model.encode(corpus, normalize_embeddings=True)

# 3. æ„å»º FAISS ç´¢å¼•ï¼ˆå¯é€‰ï¼‰
faiss_index = faiss.IndexFlatIP(dimension)
faiss_index.add(rule_vectors)
```

#### 4.3 æ··åˆæ£€ç´¢
**è¯­ä¹‰ç›¸ä¼¼åº¦ï¼ˆ70%ï¼‰+ å…³é”®è¯åŒ¹é…ï¼ˆ30%ï¼‰**

```python
# è¯­ä¹‰ç›¸ä¼¼åº¦
query_vector = model.encode([text])
semantic_similarities = np.dot(rule_vectors, query_vector)

# å…³é”®è¯åŒ¹é…
keyword_scores = [
    matched_keywords / total_keywords
    for rule in rules
]

# èåˆåˆ†æ•°
final_scores = 0.7 * semantic_similarities + 0.3 * keyword_scores
```

#### 4.4 åŠ¨æ€é˜ˆå€¼
æ ¹æ®è§„åˆ™ç±»å‹è°ƒæ•´ç›¸ä¼¼åº¦é˜ˆå€¼ï¼š

| è§„åˆ™ç±»å‹ | åŸºç¡€é˜ˆå€¼ | è°ƒæ•´åé˜ˆå€¼ | è¯´æ˜ |
|----------|----------|------------|------|
| format | 0.3 | 0.4 | æ ¼å¼ç±»è§„åˆ™è¦æ±‚æ›´ä¸¥æ ¼ |
| semantic | 0.3 | 0.25 | è¯­ä¹‰ç±»è§„åˆ™å¯ä»¥å®½æ¾ |
| structure | 0.3 | 0.3 | ç»“æ„ç±»è§„åˆ™æ ‡å‡†é˜ˆå€¼ |

**æ£€ç´¢ç»“æœ**ï¼š
```python
[
    {
        "rule_id": "R001",
        "description": "æ ‡é¢˜åº”å½“å‡†ç¡®ç®€è¦",
        "similarity": 0.85,
        "hybrid_score": 0.88,
        "keywords": ["æ ‡é¢˜", "ç®€è¦"],
        "positive_examples": ["æ­£ç¡®ç¤ºä¾‹"],
        "negative_examples": ["é”™è¯¯ç¤ºä¾‹"]
    }
]
```

---

### 5. LLM å®¡æ ¸

**æ¨¡å—**ï¼š`llm_service.py` + `reviewer.py`

#### 5.1 Prompt ä¼˜åŒ–ç­–ç•¥

**é’ˆå¯¹å°æ¨¡å‹ï¼ˆ30Bï¼‰çš„ä¼˜åŒ–**ï¼š

1. **ç²¾ç®€è§„åˆ™æ•°é‡**ï¼šåªå–æœ€ç›¸å…³çš„ 1-2 æ¡è§„åˆ™
2. **ç®€åŒ–ç¤ºä¾‹**ï¼šæ¯æ¡è§„åˆ™åªç»™ 1 ä¸ªæ­£ä¾‹å’Œ 1 ä¸ªåä¾‹
3. **ç»“æ„åŒ–æ ¼å¼**ï¼šä½¿ç”¨æ¸…æ™°çš„æ ‡è®°å’Œåˆ†éš”
4. **æ€ç»´é“¾å¼•å¯¼**ï¼šæ·»åŠ å®¡æ ¸æ­¥éª¤ï¼Œå¸®åŠ©æ¨ç†

**Prompt æ¨¡æ¿**ï¼š
```
ã€å®¡æ ¸ä»»åŠ¡ã€‘
æ£€æŸ¥ä»¥ä¸‹æ–‡æœ¬æ˜¯å¦è¿åå†™ä½œæ ‡å‡†ã€‚

ã€å¾…å®¡æ ¸æ–‡æœ¬ã€‘
{text}

ã€ä¸Šä¸‹æ–‡ã€‘
å‰æ–‡: {context_before}
åæ–‡: {context_after}

ã€é€‚ç”¨æ ‡å‡†ã€‘
1. {rule_description}
   è§„åˆ™ID: {rule_id} | ç±»åˆ«: {category} | ä¸¥é‡åº¦: {severity}
   âœ… æ­£ç¡®: {positive_example}
   âŒ é”™è¯¯: {negative_example}

ã€å®¡æ ¸æ­¥éª¤ã€‘
1. é€å¥é˜…è¯»æ–‡æœ¬
2. å¯¹æ¯”æ¯æ¡æ ‡å‡†
3. æ‰¾å‡ºæ˜ç¡®è¿åçš„åœ°æ–¹
4. å¦‚æœä¸ç¡®å®šï¼Œä¸è¦æ ‡æ³¨

ã€è¾“å‡ºæ ¼å¼ã€‘JSONæ ¼å¼
{
  "issues": [
    {
      "position": "ç¬¬Xæ®µ",
      "rule_id": "R001",
      "original_text": "åŸæ–‡ç‰‡æ®µ",
      "issue_description": "é—®é¢˜æè¿°",
      "suggestion": "ä¿®æ”¹å»ºè®®",
      "confidence": 0.9
    }
  ]
}
```

#### 5.2 API è°ƒç”¨é…ç½®

```python
# ä½æ¸©åº¦é‡‡æ ·ï¼Œä¿è¯ç¨³å®šæ€§
temperature = 0.1

# é™åˆ¶ token æ•°
max_tokens = 2000

# JSON æ ¼å¼è¾“å‡º
response_format = {"type": "json_object"}

# é‡è¯•æœºåˆ¶
@retry(stop=stop_after_attempt(3), wait=wait_exponential(min=2, max=10))
async def chat(self, messages):
    # è°ƒç”¨ DeepSeek API
```

#### 5.3 å®¡æ ¸ç»“æœè§£æ

```python
# LLM è¿”å›çš„ JSON
{
    "issues": [
        {
            "position": "ç¬¬1æ®µ",
            "rule_id": "R001",
            "category": "æ ‡é¢˜è§„èŒƒ",
            "original_text": "å…³äºåŠ å¼ºç®¡ç†çš„é€šçŸ¥",
            "issue_description": "æ ‡é¢˜è¿‡äºç¬¼ç»Ÿï¼Œæœªæ˜ç¡®å…·ä½“äº‹é¡¹",
            "suggestion": "å»ºè®®ä¿®æ”¹ä¸ºï¼šå…³äºåŠ å¼ºXXç®¡ç†çš„é€šçŸ¥",
            "confidence": 0.85,
            "severity": "medium"
        }
    ]
}
```

---

### 6. ç½®ä¿¡åº¦æ ¡å‡† â­

**æ¨¡å—**ï¼š`confidence_calibrator.py`

**ç›®æ ‡**ï¼šå‡å°‘ 50% è¯¯æŠ¥

#### 6.1 å¤šç»´åº¦æ ¡å‡†

**1. è§„åˆ™ç±»å‹æƒé‡**
```python
rule_type_weights = {
    "format": 1.2,      # æ ¼å¼ç±»æ›´å¯é ï¼ˆå¦‚æ ‡ç‚¹ã€ç©ºæ ¼ï¼‰
    "semantic": 0.85,   # è¯­ä¹‰ç±»æ›´è°¨æ…ï¼ˆå¦‚é€»è¾‘è¿è´¯ï¼‰
    "structure": 1.0,   # ç»“æ„ç±»æ ‡å‡†æƒé‡
    "content": 0.9      # å†…å®¹ç±»ç¨å¾®è°¨æ…
}
```

**2. ä¸¥é‡åº¦æƒé‡**
```python
severity_weights = {
    "high": 1.1,    # é«˜ä¸¥é‡åº¦è¦æ±‚æ›´ç¡®å®š
    "medium": 1.0,  # ä¸­ç­‰ä¸¥é‡åº¦æ ‡å‡†
    "low": 0.9      # ä½ä¸¥é‡åº¦å¯ä»¥å®½æ¾
}
```

**3. æ–‡æœ¬é•¿åº¦æƒé‡**
```python
if length < 10:
    weight = 0.6    # å¤ªçŸ­ï¼Œå¯èƒ½è¯¯æŠ¥
elif length < 20:
    weight = 0.8    # è¾ƒçŸ­ï¼Œç¨å¾®é™ä½
elif length <= 50:
    weight = 1.0    # é€‚ä¸­ï¼Œæ ‡å‡†æƒé‡
elif length <= 100:
    weight = 0.95   # è¾ƒé•¿ï¼Œç•¥å¾®é™ä½
else:
    weight = 0.85   # å¤ªé•¿ï¼Œå¯èƒ½ä¸å¤Ÿç²¾ç¡®
```

**4. ä¸Šä¸‹æ–‡ä¸€è‡´æ€§æƒé‡**
- åŸæ–‡ä¸åœ¨æ–‡æœ¬å—ä¸­ï¼šÃ— 0.5
- åŸæ–‡åªæœ‰æ ‡ç‚¹ç¬¦å·ï¼šÃ— 0.3
- åŸæ–‡åªæœ‰æ•°å­—ï¼šÃ— 0.4
- é—®é¢˜æè¿°å¤ªçŸ­ï¼ˆ< 10 å­—ç¬¦ï¼‰ï¼šÃ— 0.8
- å»ºè®®å¤ªçŸ­ï¼ˆ< 10 å­—ç¬¦ï¼‰ï¼šÃ— 0.9

**5. å†å²å‡†ç¡®ç‡æƒé‡**
```python
if accuracy < 0.5:
    weight = 0.7    # å†å²è¯¯æŠ¥ç‡é«˜
elif accuracy < 0.7:
    weight = 0.85   # å†å²å‡†ç¡®ç‡ä¸€èˆ¬
else:
    weight = 1.0    # å†å²å‡†ç¡®ç‡é«˜
```

#### 6.2 ç»¼åˆæ ¡å‡†å…¬å¼

```python
calibrated_confidence = (
    original_confidence 
    Ã— type_weight 
    Ã— severity_weight 
    Ã— length_weight 
    Ã— context_weight 
    Ã— history_weight
)
```

#### 6.3 åŠ¨æ€é˜ˆå€¼è¿‡æ»¤

```python
# åŸºç¡€é˜ˆå€¼
min_confidence = 0.7

# é«˜ä¸¥é‡åº¦é—®é¢˜ï¼šæ›´ä¸¥æ ¼
if severity == "high" and confidence < 0.85:
    filter = True

# ä½ä¸¥é‡åº¦é—®é¢˜ï¼šå¯ä»¥å®½æ¾
if severity == "low" and confidence >= 0.65:
    filter = False
```

**æ ¡å‡†æ•ˆæœç¤ºä¾‹**ï¼š
```
åŸå§‹é—®é¢˜: 10 ä¸ª
â”œâ”€ è§„åˆ™ç±»å‹æ ¡å‡†: 2 ä¸ªé™ä½ç½®ä¿¡åº¦
â”œâ”€ æ–‡æœ¬é•¿åº¦æ ¡å‡†: 1 ä¸ªé™ä½ç½®ä¿¡åº¦
â”œâ”€ ä¸Šä¸‹æ–‡ä¸€è‡´æ€§: 2 ä¸ªå¤§å¹…é™ä½ç½®ä¿¡åº¦
â””â”€ è¿‡æ»¤å: 5 ä¸ªï¼ˆå‡å°‘ 50% è¯¯æŠ¥ï¼‰
```

---

### 7. ç»“æœå±•ç¤º

**æ¨¡å—**ï¼š`frontend/index.html`

#### 7.1 æµå¼è¾“å‡ºï¼ˆSSEï¼‰

**ä¼˜åŠ¿**ï¼š
- å®æ—¶æ˜¾ç¤ºå®¡æ ¸è¿›åº¦
- é€ä¸ªé—®é¢˜æ¨é€ï¼Œç”¨æˆ·ä½“éªŒå¥½
- é¿å…é•¿æ—¶é—´ç­‰å¾…

**å®ç°**ï¼š
```javascript
// åç«¯æµå¼æ¨é€
async def generate():
    yield f"data: {json.dumps({'type': 'status', 'message': 'æ­£åœ¨è§£æ...'})}\n\n"
    yield f"data: {json.dumps({'type': 'progress', 'current': 1, 'total': 10})}\n\n"
    yield f"data: {json.dumps({'type': 'issue', 'data': issue})}\n\n"
    yield f"data: {json.dumps({'type': 'complete', 'total_issues': 5})}\n\n"

// å‰ç«¯æ¥æ”¶
const reader = response.body.getReader();
while (true) {
    const { done, value } = await reader.read();
    if (done) break;
    // è§£æ SSE æ•°æ®
    if (data.type === 'issue') {
        addIssueToList(data.data);
    }
}
```

#### 7.2 ç»“æœå±•ç¤º

**ç»Ÿè®¡å¡ç‰‡**ï¼š
- æ€»é—®é¢˜æ•°
- é«˜ä¸¥é‡åº¦é—®é¢˜æ•°
- ä¸­ä¸¥é‡åº¦é—®é¢˜æ•°
- ä½ä¸¥é‡åº¦é—®é¢˜æ•°

**é—®é¢˜è¯¦æƒ…**ï¼š
- ä½ç½®ï¼ˆç¬¬Xæ®µï¼‰
- åŸæ–‡ç‰‡æ®µ
- é—®é¢˜æè¿°
- ä¿®æ”¹å»ºè®®
- ç½®ä¿¡åº¦
- è§„åˆ™ID

---

## æ ¸å¿ƒæ¨¡å—åˆ†æ

è¯¦è§é™„ä»¶æ–‡æ¡£ï¼š
- [æ ¸å¿ƒæ¨¡å—è¯¦ç»†åˆ†æ](./é¡¹ç›®æ·±åº¦åˆ†æ-æ ¸å¿ƒæ¨¡å—.md)
- [ä¼˜åŒ–å»ºè®®è¯¦ç»†è¯´æ˜](./é¡¹ç›®æ·±åº¦åˆ†æ-ä¼˜åŒ–å»ºè®®.md)

---

## æ€»ç»“

### é¡¹ç›®ä¼˜åŠ¿

1. **æ¶æ„æ¸…æ™°**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£åˆ†æ˜
2. **æ™ºèƒ½ä¼˜åŒ–**ï¼šå‡å°‘ 50% LLM è°ƒç”¨ï¼Œæå‡ 2-3 å€é€Ÿåº¦
3. **ç½®ä¿¡åº¦æ ¡å‡†**ï¼šå¤šç»´åº¦æ ¡å‡†ï¼Œå‡å°‘ 50% è¯¯æŠ¥
4. **ç”¨æˆ·ä½“éªŒ**ï¼šæµå¼è¾“å‡ºï¼Œå®æ—¶åé¦ˆ
5. **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°æ ‡å‡†ã€æ–°æ¨¡å‹

### ä¸»è¦é—®é¢˜

1. **å®‰å…¨æ€§**ï¼šAPI Key ç¡¬ç¼–ç 
2. **å¥å£®æ€§**ï¼šé”™è¯¯å¤„ç†ä¸å®Œå–„
3. **åŠŸèƒ½æ€§**ï¼šç¼ºå°‘æŠ¥å‘Šå¯¼å‡ºã€æ‰¹é‡å®¡æ ¸
4. **å¯ç»´æŠ¤æ€§**ï¼šç¼ºå°‘å•å…ƒæµ‹è¯•

### æ”¹è¿›æ–¹å‘

1. **ç«‹å³ä¿®å¤**ï¼šç§»é™¤ç¡¬ç¼–ç  API Keyï¼Œå®Œå–„é”™è¯¯å¤„ç†
2. **çŸ­æœŸä¼˜åŒ–**ï¼šå®ç°æ‰¹é‡å®¡æ ¸ã€æŠ¥å‘Šå¯¼å‡º
3. **ä¸­æœŸå¢å¼º**ï¼šæ·»åŠ æµ‹è¯•ã€å®Œå–„æ ‡å‡†ç®¡ç†
4. **é•¿æœŸè§„åˆ’**ï¼šDocker éƒ¨ç½²ã€ç»Ÿè®¡åˆ†æ

---

**æŠ¥å‘Šå®Œæˆæ—¶é—´**ï¼š2026å¹´2æœˆ15æ—¥  
**åˆ†æäººå‘˜**ï¼šAI åŠ©æ‰‹  
**ç‰ˆæœ¬**ï¼šv1.0

